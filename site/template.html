<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} | {{date}}</title>
    
    <!-- SEO & Social Meta Tags -->
    <meta name="description" content="Daily actionable insights from the top AI repositories on GitHub. Stay updated with what's new in AI development.">
    <meta property="og:title" content="{{title}} | {{date}}">
    <meta property="og:description" content="Daily actionable insights from the top AI repositories on GitHub.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ai-changelog-insights.github.io/">
    <!-- <meta property="og:image" content="https://ai-changelog-insights.github.io/og-image.png"> -->
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="AI Changelog Insights RSS Feed" href="/feed.xml" />
    
    <link rel="stylesheet" href="style.css?v={{ generated_at }}">
    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
        
        // Init theme
        const saved = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', saved);

        // Accordion Functionality
        document.addEventListener('DOMContentLoaded', () => {
            const summaries = document.querySelectorAll('.changelog-summary');
            
            // Add Copy Buttons to Code Blocks
            function addCopyButtons() {
                document.querySelectorAll('pre').forEach(pre => {
                    // Check if button already exists
                    if (pre.querySelector('.copy-btn')) return;

                    const button = document.createElement('button');
                    button.className = 'copy-btn';
                    button.textContent = 'Copy';
                    button.setAttribute('aria-label', 'Copy code to clipboard');

                    button.addEventListener('click', async (e) => {
                        e.stopPropagation(); // Prevent accordion from toggling if button is clicked
                        
                        const code = pre.querySelector('code');
                        const text = code ? code.innerText : pre.innerText;
                        // Remove the button text itself if it was somehow included (unlikely with querySelector('code') but possible with innerText on pre)
                        const textToCopy = text.replace('Copy', '').replace('Copied!', '').replace('Error', '').trim();

                        try {
                            if (navigator.clipboard && window.isSecureContext) {
                                await navigator.clipboard.writeText(textToCopy);
                            } else {
                                // Fallback for non-secure contexts (e.g. file:// or http://)
                                const textArea = document.createElement('textarea');
                                textArea.value = textToCopy;
                                textArea.style.position = 'fixed';
                                textArea.style.left = '-9999px';
                                textArea.style.top = '0';
                                document.body.appendChild(textArea);
                                textArea.focus();
                                textArea.select();
                                try {
                                    document.execCommand('copy');
                                } catch (err) {
                                    console.error('Fallback copy failed', err);
                                    throw new Error('Copy failed');
                                }
                                document.body.removeChild(textArea);
                            }

                            // Success feedback
                            const originalText = button.textContent;
                            button.textContent = 'Copied!';
                            button.classList.add('copied');
                            
                            setTimeout(() => {
                                button.textContent = originalText;
                                button.classList.remove('copied');
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy:', err);
                            button.textContent = 'Error';
                            setTimeout(() => {
                                button.textContent = 'Copy';
                            }, 2000);
                        }
                    });

                    pre.appendChild(button);
                });
            }
            
            // Run initially
            addCopyButtons();
            
            summaries.forEach(summary => {
                const children = Array.from(summary.children);
                if (children.length === 0) return;

                const newContainer = document.createDocumentFragment();
                let currentSection = null;
                let currentContent = null;
                let hasSections = false;

                // Check if we have any h3s to determine if we should apply accordion structure
                const hasH3 = children.some(child => child.tagName === 'H3');

                if (!hasH3) {
                    // If no sections defined, leave as is (or wrap in one open section?)
                    // For now, let's leave it alone if no structure detected.
                    return;
                }

                children.forEach(child => {
                    if (child.tagName === 'H3') {
                        // Close previous section
                        if (currentSection && currentContent) {
                            currentSection.appendChild(currentContent);
                            newContainer.appendChild(currentSection);
                        }

                        // Start new section
                        currentSection = document.createElement('div');
                        currentSection.className = 'accordion-section';

                        const header = document.createElement('button');
                        header.className = 'accordion-header';
                        header.setAttribute('aria-expanded', 'false');
                        
                        // Move H3 inside button or keep as H3?
                        // Better accessibility: Button containing the H3 content
                        // But we want to keep semantic H3. 
                        // Let's make the button wrap the H3 or put H3 inside.
                        // CSS expects .accordion-header h3
                        
                        const h3 = child.cloneNode(true);
                        header.appendChild(h3);

                        header.addEventListener('click', function() {
                            const expanded = this.getAttribute('aria-expanded') === 'true';
                            this.setAttribute('aria-expanded', !expanded);
                            
                            const content = this.nextElementSibling;
                            if (content) {
                                content.classList.toggle('expanded');
                                if (!expanded) {
                                    content.style.maxHeight = content.scrollHeight + "px";
                                } else {
                                    content.style.maxHeight = null;
                                }
                            }
                        });

                        currentSection.appendChild(header);

                        currentContent = document.createElement('div');
                        currentContent.className = 'accordion-content';
                        hasSections = true;
                    } else {
                        if (currentContent) {
                            currentContent.appendChild(child.cloneNode(true));
                        } else {
                            // Content before first H3, or if no H3s found yet.
                            // If we are strictly following "What's New" etc., there should be an H3 first.
                            // If not, maybe create a default section or append to fragment?
                            // Let's append to a default "Overview" section if we want, or just pre-text.
                            // Given the prompt, likely strict structure.
                            // Let's create a "General" section if content exists before first H3?
                            // Or just leave it outside.
                            if (!currentSection) {
                                // Create a pre-content div
                                const preDiv = document.createElement('div');
                                preDiv.appendChild(child.cloneNode(true));
                                newContainer.appendChild(preDiv);
                            }
                        }
                    }
                });

                // Append final section
                if (currentSection && currentContent) {
                    currentSection.appendChild(currentContent);
                    newContainer.appendChild(currentSection);
                }

                if (hasSections) {
                    summary.innerHTML = '';
                    summary.appendChild(newContainer);
                }
            });
        });
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="title-group">
                <h1>{{title}}</h1>
                <p class="subtitle">Daily AI Updates for <span class="highlight">{{date}}</span></p>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                ðŸŒ—
            </button>
        </div>
    </header>
    
    <main>
        {% if repos %}
            {% for repo in repos %}
            <article class="repo-card">
                <div class="repo-header">
                    <h2><a href="{{repo.url}}" target="_blank">{{repo.name}}</a></h2>
                    <div class="repo-meta">
                        <span class="stars">â˜… {{repo.stars}}</span>
                    </div>
                </div>
                <p class="repo-description">{{repo.description}}</p>
                <div class="changelog-summary">
                    {{repo.summary_html}}
                </div>
            </article>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>No significant changelog updates found for today yet.</p>
                <p class="sub-text">Check back later or view yesterday's archives.</p>
            </div>
        {% endif %}
    </main>

    <footer>
        <p>Generated at {{generated_at}} â€¢ Powered by OpenRouter + GitHub API</p>
    </footer>
</body>
</html>
